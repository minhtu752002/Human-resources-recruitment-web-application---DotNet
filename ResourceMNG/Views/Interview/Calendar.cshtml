@using ResourceEntity.Models
@{
    var calendarData = ViewBag.Interviews as List<Interview>;
    ViewData["Title"] = "Lịch phỏng vấn";
}
<script src='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.js'></script>

<div class="col-lg-12 grid-margin stretch-card">
    <div class="card">
        <div class="card-header d-flex justify-content-between">
            <h4>@ViewData["Title"]</h4>
            <div>

                <a class="btn btn-primary mr-1 justify-content-end" asp-controller="Interview" asp-action="ListInterview">Danh sách phỏng vấn</a>

            </div>
        </div>
        <div class="card-body">
            <div id='calendar'></div>
        </div>
    </div>
</div>
@* //modal *@
<div class="modal" id="schedule-edit" style="background-color:rgba(0, 0, 0, 0.5);">
    <div class="modal-dialog">
        <div class="modal-content">
            <!-- Modal Header -->
            <div class="modal-body">
                <div class="card card-header text-center ">
                    <h4 class="modal-title">Thông tin buổi phỏng vấn</h4>
                </div>

                <!-- Modal body -->
                <div class="modal-body">
                    <div class="table-responsive">
                        <table class="table">
                            <tbody>
                                <tr>
                                    <th scope="row">Ứng cử viên:</th>
                                    <td></td>

                                </tr>
                                <tr>
                                    <th scope="row">Mô tả cuộc phỏng vấn:</th>
                                    <td> </td>

                                </tr>
                                <tr>
                                    <th scope="row">Địa chỉ phỏng vấn:</th>
                                    <td></td>

                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                <!-- Modal footer -->
                <div class="text-center">
                    <button type="button" class="btn btn-danger" onclick="closeModal()">Đóng</button>
                </div>
            </div>
        </div>
    </div>
    @section Scripts{
        <script>
            var modal = document.getElementById("schedule-edit");
            function closeModal() {
                modal.style.display = "none";
            }
            window.addEventListener("click", function (event) {
                if (event.target === modal) {
                    modal.style.display = "none";
                }
            });
            document.addEventListener('DOMContentLoaded', function () {
                var calendarEl = document.getElementById('calendar');
                var calendar = new FullCalendar.Calendar(calendarEl, {
                    eventClick: function (event) {
                        modal.style.display = "block";
                        var IAddress = event.event.extendedProps.interviewAddress;
                        var IName = event.event.extendedProps.interviewApplicant;
                        var IDesc = event.event.extendedProps.interviewDesc;
                        var modalTable = document.querySelector(".modal-body .table");
                        modalTable.querySelector("tr:nth-child(1) td").textContent = IName;
                        modalTable.querySelector("tr:nth-child(2) td").textContent = IDesc;
                        modalTable.querySelector("tr:nth-child(3) td").textContent = IAddress;
                    },
                    initialView: 'dayGridMonth',
                    headerToolbar: {
                        start: 'title',
                        center: '',
                        end: 'today prev,next'
                    },
                    dayMaxEvents: true,
                    events: [
            @foreach (var cld in calendarData)
            {
                @Html.Raw('{')
                @Html.Raw("title:'" + @cld.InterviewDescription + "',")
                @Html.Raw("start:'" + @cld.InterviewSd.Value.ToString("yyyy-MM-dd hh:mm") +"',")
                @Html.Raw("interviewId:'" + @cld.InterviewId +"',")
                @Html.Raw("interviewAddress:'" + @cld.InterviewAddress +"',")
                @Html.Raw("interviewApplicant:'" + @cld.Applicant.ApplicantName +"',")
                @Html.Raw("interviewDesc:'" + @cld.InterviewDescription +"',")
                @Html.Raw("},")
            }
                                    ]
                },);
                calendar.render();
            });

        </script>
    }
