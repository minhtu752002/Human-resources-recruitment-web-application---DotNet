@using ResourceEntity
@model List<ResourceEntity.Models.Vacancy>

@{
    ViewData["Title"] = "Danh sách tuyển dụng";

}
@*<link href="https://cdn.datatables.net/1.13.6/css/dataTables.bootstrap5.min.css" rel="stylesheet" crossorigin="anonymous">
*@
@section Scripts{
    <script>
        setTimeout(function () {
            $('#msgAlert').fadeOut("slow");
        }, 2000)
    </script>
}
@if (ViewBag.Msg != null)
{
    <div id="msgAlert" class="alert alert-success" style="position:absolute; z-index:10; top: 80px;
    left: 50%;
    transform: translate(-50%); " role="alert">
        <i class="fa fa-check"></i>
        @ViewBag.Msg
    </div>
}
@if (ViewBag.MsgError != null)
{
    <div id="msgAlert" class="alert alert-danger" style="position:absolute; z-index:10; top: 80px;
    left: 50%;
    transform: translate(-50%); " role="alert">
        <i class="fa fa-warning"></i>
        @ViewBag.MsgError
    </div>
}

    <div class="col-lg-12 grid-margin stretch-card">
        <div class="card">
            <div class="card-header d-flex justify-content-between">
                <h4>@ViewData["Title"]</h4>
            </div>
            <div class="card-header">

            <form id="searchFilter" asp-action="ListVacancy" method="post" enctype="multipart/form-data">
                    <div asp-validation-summary="All" class="text-danger"></div>
                <div class="row">
                    <div class="col-12 col-md-3">
                        <div class="form-group d-flex flex-column">
                            <label class="control-label">Lọc theo vị trí tuyển dụng</label>
                            <select id="title" class="search-VacancyJobTitle form-control" name="title">
                                <option value="All">All</option>
                                @foreach (var item in ViewBag.SearchList)
                                {
                                    if (item == ViewBag.SearchValueTitle)
                                    {
                                        <option value="@item" selected="selected">@item</option>
                                    }
                                    else
                                    {
                                        <option value="@item">@item</option>
                                    }
                                    @* <option value="@item">@item</option> *@
                                }
                            </select>
                            @* <input type="search" class="form-control" placeholder="Ex: .NET" name="title"> *@
                        </div>
                    </div>
                    <div class="col-12 col-md-3">
                        <div class="form-group d-flex flex-column">
                            <label class="control-label">Lọc theo nhà tuyển dụng</label>
                            <select id="ntd" class="search-ntd form-control" name="ntd">
                                <option value="All">All</option>

                                @foreach (var item in ViewBag.SearchListNTD)
                                {
                                    if (item == ViewBag.SearchValueNtd)
                                    {
                                        <option value="@item" selected="selected">@item</option>
                                    }
                                    else
                                    {
                                        <option value="@item">@item</option>
                                    }
                                    @* <option value="@item">@item</option> *@
                                }
                            </select>
                        </div>
                    </div>
                    <div class="col-12 col-md-6 d-flex justify-content-between align-items-center">
                        <div>
                            <a href="@Url.Action("ListVacancy",new {expr = true})" class="btn btn-primary text-white my-1">Chưa hết hạn</a>
                            <input type="submit" value="Lọc" class="btn btn-primary" />
                        </div>
                        <div>

                            <a class="btn btn-primary mr-1 justify-content-end" asp-controller="Vacancy" asp-action="RegisterVacancy">Thêm</a>
                            <a class="btn btn-success mr-1 justify-content-end my-1" href="javascript:exportVacancyFilter()">Export</a>
                        </div>

                    </div>
                 </div>
                
                </form>
            </div>
            <div class="card-body">
               
            <table id="table-Vacancy" class="table table-striped mb-0 " style="width:100%">
                    <thead>
                        <tr>
                            <th class="align-middle" ">ID</th>
                            <th class="align-middle">Công việc<br>tuyển dụng</th>
                            <th class="align-middle">Thông tin<br>tuyển dụng</th>
                            <th class="align-middle">Ngày bắt đầu</th>
                            <th class="align-middle">Ngày kết thúc</th>
                            <th class="align-middle">
                                Số lượng <br> tuyển dụng
                            </th>
                            <th class="align-middle">Nhà tuyển dụng</th>
                            <th class="align-middle">Action</th>
                        </tr>
                    </thead>
                    <tbody>

                        @foreach (var vacancy in ViewBag.Vacancies)
                        {
                            <tr>
                                <td >
                                    @vacancy.VacancyId
                                </td>
                                <td>
                                    @vacancy.VacancyJobTitle
                                </td>
                                <td >
                                    <a href="/uploads/@vacancy.VacancyDetails" target="_blank"><i class="fa fa-file-pdf-o"></i>&nbsp;PDF</a>
                                </td>
                                <td>
                                    @Common.DateToString(vacancy.VacancyOd)
                                </td>
                                <td>
                                    @Common.DateToString(vacancy.VacancyCd)
                                </td>
                                <td>
                                    @vacancy.VacancyAmout
                                </td>
                                <td>
                                    @vacancy.VacancyHm
                                </td>
                                <td>
                                    <a class="mr-2" href="@Url.Action("Edit", "Vacancy", new { id = vacancy.VacancyId })" title="Chỉnh sửa">
                                        <i class="fa fa-edit text-success mr-2" style="font-size:larger"></i>
                                    </a>
                                    @* <a href="@Url.Action("Delete", "Vacancy", new { id = vacancy.VacancyId })" title="Xóa">
                                    <i class="fa fa-trash-o text-danger" style="font-size:larger"></i>
                                </a> *@
                                    <a style="cursor:pointer"
                                    title="Xóa"
                                    data-toggle="Delete-modal-vacacy"
                                    data-target="#DeleteVacancy"
                                    data-url="@Url.Action("DeleteVacacyModal","Vacancy", new { id = vacancy.VacancyId })">
                                        <i class="fa fa-trash-o text-danger" style="font-size:larger"></i>
                                    </a>
                                </td>
                            </tr>
                        }


                    </tbody>
                
                </table>

            </div>
        </div>
    </div>


<div id="DeleteModalVacacy"></div>
@await Html.PartialAsync("_DataTableScripts")
<script>

    function exportVacancyFilter() {
        window.location.href = "/Report/PrintVacancy?title=" + $('#title').val() + "&ntd=" + $('#ntd').val();
    }

    $('.search-VacancyJobTitle').select2({
        placeholder: "Ex: .Net"
    });
    $('.search-ntd').select2({
        placeholder: "Ex: HPT"
    });
    
    var table = $('#table-Vacancy').DataTable({
        columnDefs: [
            {
                target: 0,
                visible: false,
                searchable: false
            }
        ],
        scrollX: true,
        // initComplete: function () {
        //     this.api()
        //         .columns([1,3,4,6])
        //         .every(function () {
        //             var column = this;

        //             // Create select element and listener
        //             var select = $('<select><option value=""></option></select>')
        //                 .appendTo($(column.footer()).empty())
        //                 .on('change', function () {
        //                     var val = DataTable.util.escapeRegex($(this).val());

        //                     column
        //                         .search(val ? '^' + val + '$' : '', true, false)
        //                         .draw();
        //                 });

        //             // Add list of options
        //             column
        //                 .data()
        //                 .unique()
        //                 .sort()
        //                 .each(function (d, j) {
        //                     select.append(
        //                         '<option value="' + d + '">' + d + '</option>'
        //                     );
        //                 });
        //         });
        // }
    });
    table
        .order([0, 'desc'])
        .draw();
</script>